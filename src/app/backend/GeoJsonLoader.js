
class GeoJsonLoader {

  static getMarkers(data) {
    return data.beacons.map(beacon => {
      return {
        type: "Feature",
        properties: {valided: beacon.valided},
        geometry: {
          type: "Point",
          coordinates: beacon.coords,
        },
      };
    });
  }

  static getLines(data) {
      let ret = []
        for (let i = 0; i < data.rawPositions.length - 1; i++) {
            ret.push({
                "type": "Feature",
                "properties": {speed: data.speeds[i]},
                "geometry": {
                  "type": "LineString",
                  "coordinates": [
                    data.rawPositions[i],
                    data.rawPositions[i + 1]
                  ]
                }
              })   
        }
        return ret;
  }

  static getTeacherMarkers(data) {
      return data.beacons.map(beacon => {
        return {
          type: "Feature",
          properties: {id: beacon.id},
          geometry: {
            type: "Point",
            coordinates: beacon.coords,
          },
        };
      });
    }

  static getTeacherLines(data) {
    return data.runs.map(run => {
      return {
        "type": "Feature",
        "properties": {id: run.id},
        "geometry": {
          "type": "LineString",
          "coordinates": run.rawPositions
        }
      }
    })
  }

  static createGeoJson(data) {
      let featureCollection = {
        "type": "FeatureCollection",
        "features": []
      };
      let markers = GeoJsonLoader.getMarkers(data);
      let lines = GeoJsonLoader.getLines(data);
    //   featureCollection.features = featureCollection.features.concat(markers, lines);
      featureCollection.features = featureCollection.features.concat(lines);

      return featureCollection;
  }
  static createTeacherGeoJson(data) {
    let featureCollection = {
      "type": "FeatureCollection",
      "features": []
    };
    let markers = GeoJsonLoader.getTeacherMarkers(data);
    let lines = GeoJsonLoader.getTeacherLines(data);
    featureCollection.features = featureCollection.features.concat(lines);
    return featureCollection;
  }
};

module.exports = GeoJsonLoader

// data = {"id":"mov4","firmwareVersion":0.1,"sampleRate":1,"beacons":[{"id":1,"valided":true,"name":"","coords":[48.838426,2.200067],"avgSpeed":0,"time":1,"lap":1},{"id":2,"valided":false,"name":"","coords":[48.838352,2.203357],"avgSpeed":null,"time":null,"lap":null},{"id":3,"valided":false,"name":"","coords":[48.839387,2.19841],"avgSpeed":null,"time":null,"lap":null},{"id":4,"valided":true,"name":"","coords":[48.839224,2.203405],"avgSpeed":3.786760754789737,"time":6,"lap":5},{"id":5,"valided":false,"name":"","coords":[48.837686,2.200015],"avgSpeed":null,"time":null,"lap":null},{"id":6,"valided":false,"name":"","coords":[48.837518,2.20278],"avgSpeed":null,"time":null,"lap":null},{"id":7,"valided":false,"name":"","coords":[48.839373,2.200848],"avgSpeed":null,"time":null,"lap":null},{"id":8,"valided":false,"name":"","coords":[48.838423,2.198175],"avgSpeed":null,"time":null,"lap":null},{"id":9,"valided":false,"name":"","coords":[48.838866,2.20234],"avgSpeed":null,"time":null,"lap":null}],"rawPositions":[[48.83842089934189,2.200108766555786],[48.83841383778495,2.2001677751541138],[48.83841030700611,2.2002536058425903],[48.83841030700611,2.200334072113037],[48.83841383778495,2.200414538383484],[48.839224,2.203405],[48.83836087607625,2.2005271911621094],[48.83833262980869,2.200586199760437],[48.83832909902415,2.200655937194824],[48.83833616059302,2.2007256746292114],[48.83836087607625,2.2007793188095093],[48.838389122327854,2.200811505317688],[48.838435022452764,2.2008275985717773],[48.838480922535624,2.2008436918258667],[48.83852682257639,2.200870513916015],[48.83852682257639,2.2009670734405518],[48.838502107175046,2.2010421752929688],[48.83843855322985,2.2010475397109985],[48.838399714668114,2.2010475397109985],[48.838364406858574,2.2011011838912964],[48.83834322216088,2.2011440992355347],[48.8383149758834,2.201181650161743],[48.838300852738676,2.2012192010879517],[48.83828672958997,2.2012460231781006],[48.83826907564849,2.2012674808502197],[48.838247890910495,2.201283574104309],[48.83820199061414,2.2012996673583984],[48.838141967086166,2.2012996673583984],[48.83807135107883,2.201310396194458],[48.8380254506207,2.2013050317764282],[48.837976019311036,2.201213836669922],[48.83795836526004,2.201138734817505],[48.837951303637915,2.201106548309326],[48.837940711202826,2.2010797262191772],[48.837937180390654,2.2010475397109985],[48.837912464698356,2.20101535320282],[48.837838317548325,2.200988531112671],[48.837806540164735,2.2009295225143433],[48.837799478521184,2.200886607170105],[48.837799478521184,2.2007793188095093],[48.83783125590928,2.200714945793152],[48.837901872255074,2.20074713230133],[48.837940711202826,2.200790047645569],[48.837976019311036,2.2008222341537476],[48.838014858201284,2.2007685899734497],[48.83801838900801,2.2006720304489136],[48.83801838900801,2.200607657432556],[48.83801838900801,2.200559377670288],[48.83802191981448,2.200521826744079],[48.83802191981448,2.2004735469818115],[48.8380254506207,2.200435996055603],[48.8380254506207,2.2003716230392456],[48.83805722786541,2.2003179788589478],[48.83807135107883,2.200285792350769],[48.83807488188157,2.200232148170471],[48.83807841268404,2.2001785039901733],[48.83808194348629,2.2001463174819946],[48.83808194348629,2.200108766555786],[48.83808900509,2.2000443935394287],[48.83811725149493,2.200033664703369],[48.83815962107245,2.2000175714492793],[48.83819139823208,2.20001220703125],[48.83823376774687,2.20001220703125],[48.838258483280626,2.2000497579574585],[48.83829026037753,2.2000926733016968],[48.838318506668955,2.2001248598098755],[48.83835381451083,2.2001034021377563]],"speeds":[0,0.39661670651200714,0.5732997355392296,0.5370149905441695,0.5375309557745868,20.676102140368428,20.049898825994745,0.43654392255277386,0.4660082433753405,0.4677894530830151,0.3941296737108561,0.28570100211890054,0.3243975008587849,0.3243972331313254,0.3545994574271771,0.6444179886559671,0.5276194839690945,0.42534211684304885,0.2590091703571739,0.4285020473286434,0.3193571456373873,0.31350815039187374,0.26772139779485365,0.20227128842448344,0.185386491918956,0.1774680893713619,0.32439848826503553,0.4002888072485728,0.47634085712771024,0.3081904365921307,0.6921591227408909,0.5148557127083674,0.21990763436353059,0.19243890477813982,0.21609269842627507,0.27075655038368446,0.525880901920115,0.4472100360032843,0.2902538635573775,0.7160199873922259,0.4790367497236312,0.5176076493348327,0.38615624887964234,0.3187246820196985,0.4418801460674965,0.6448480293431086,0.42961199243533554,0.3222089943265017,0.2517107529247796,0.322208994323538,0.25171075289347405,0.42961199243533554,0.41602946782190375,0.23454763609976684,0.3587834883650145,0.35878348830553874,0.2160926927639292,0.25060699558727906,0.43218538525521816,0.2015210015104161,0.3022813184106543,0.21492057471245737,0.2825568199425658,0.29995174231425226,0.3562842976964973,0.28570123439202516,0.2755910137101242],"avgSpeed":0.9619489754445751,"distance":1074.176355913109,"time":67,"comment":"","rating":null,"sessionName":"Session test 1","sessionId":"1"}
// console.dir(GeoJsonLoader.createGeoJson(data), { depth: null });